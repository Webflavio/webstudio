  app:
    init: true
    privileged: true
    build:
      context: .
      dockerfile: Dockerfile

    volumes:
      - .:/workspaces/webstudio:cached
      - ./.devcontainer/.local:/home/node/.local
      - docker-data:/var/lib/docker

    entrypoint: ["/usr/local/share/docker-init.sh"]
    command: sleep infinity

    # صححنا السطر هنا
    network_mode: service:db

    depends_on:
      db:
        condition: service_healthy

  rest:
    container_name: supabase-rest
    image: postgrest/postgrest:v12.2.0
    depends_on:
      db:
        condition: service_healthy
    restart: unless-stopped
    environment:
      PGRST_DB_URI: postgresql://postgres:pass@db/webstudio
      PGRST_DB_SCHEMAS: ${PGRST_DB_SCHEMAS:-public}
      PGRST_DB_ANON_ROLE: anon
      PGRST_JWT_SECRET: ${JWT_SECRET:-jwtsecretjwtsecretjwtsecretjwtsecretjwtsecretjwtsecretjwtsecretjwtsecretjwtsecretjwtsecretjwtsecretjwtsecret}
      PGRST_DB_USE_LEGACY_GUCS: "false"
      PGRST_APP_SETTINGS_JWT_SECRET: ${JWT_SECRET:-jwtsecretjwtsecretjwtsecretjwtsecretjwtsecretjwtsecretjwtsecretjwtsecretjwtsecretjwtsecretjwtsecretjwtsecret}
      PGRST_APP_SETTINGS_JWT_EXP: ${JWT_EXPIRY}
    command: "postgrest"

    # صححنا السطر هنا
    network_mode: service:db
